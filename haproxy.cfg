global
    log stdout format raw local0
    maxconn 2048
    tune.ssl.default-dh-param 2048

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    option  redispatch
    retries 3
    timeout http-request 10s
    timeout connect 10s
    timeout client 30s
    timeout server 30s
    timeout check 10s

frontend http-in
    bind *:80
    option forwardfor
    
    # ACLs for routing
    acl is_auth path_beg /auth
    acl is_waste path_beg /waste
    
    # Use backends based on ACLs
    use_backend auth_backend if is_auth
    use_backend waste_backend if is_waste
    
    # Default backend for undefined routes
    default_backend default_backend

backend auth_backend
    balance roundrobin
    option httpchk GET /auth/health
    http-check expect status 200
    server auth-service auth-service:5001 check inter 5s fall 3 rise 2

backend waste_backend
    balance roundrobin
    option httpchk GET /waste/health
    http-check expect status 200
    server waste-service waste-service:5002 check inter 5s fall 3 rise 2

backend default_backend
    mode http
    http-request deny deny_status 404


